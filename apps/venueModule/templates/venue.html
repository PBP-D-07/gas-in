{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>gas.in</title>
{% endblock meta %}

{% block content %}

<div class="flex flex-col items-center pt-20 min-h-screen">
    <p>Welcome to the venue page!</p>
    <p>Pick your favorite venue!!!</p>
    <div class="mt-4">
        <a href="{% url 'main:show_main' %}" class="text-blue-500 hover:underline">Back to Home</a>
    </div>

    <!-- Loading State -->
    <div id="loading" class="bg-white rounded-lg border border-gray-200 p-12 text-center hidden">
      <svg class="animate-spin h-8 w-8 text-blue-600 inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
      <p class="text-gray-600 mt-3">Loading products...</p>
    </div>

    <!-- Error State -->
    <div id="error" class="hidden"></div>

    <!-- Product Grid -->
    <div id="grid" class="hidden"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
<script>

// Configuration
const VENUE_API_ENDPOINT = "{% url 'venue:show_json_venue' %}";
const CURRENT_USER_ID = "{{ user.id|default_if_none:'' }}";

// DOM Elements
const loadingSpinner = document.getElementById('loading');
const errorMessage = document.getElementById('error');
const eventGridContainer = document.getElementById('grid');

let allVenuesData = [];

// Show/hide page sections
function displayPageSection({ showLoading = false, showError = false, showEmpty = false, showGrid = false }) {
  loadingSpinner.classList.toggle('hidden', !showLoading);
  errorMessage.classList.toggle('hidden', !showError);
  eventGridContainer.classList.toggle('hidden', !showGrid);
  
  // Add grid classes when showing grid
  if (showGrid) {
    eventGridContainer.className = 'grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4';
  }
}

// Get readable category name
{% comment %} function getReadableCategoryName(categoryCode) {
  const categoryMapping = {
    'apparel': 'Apparel',
    'footwear': 'Footwear',
    'accessories': 'Accessories',
    'equipment': 'Equipment',
    'merchandise': 'Merchandise',
  };
  return categoryMapping[categoryCode] || categoryCode;
} {% endcomment %}

// Create product card element
{% comment %} function buildProductCardElement(item) {
    const article = document.createElement('article');
    article.className = 'bg-white rounded-lg border-2 border-gray-300 hover:shadow-lg transition-shadow duration-300 overflow-hidden flex flex-col h-full';

    const linkDetail = `{% url 'main:show_product' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', item.id);
    const linkEdit = `{% url 'main:edit_product' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', item.id);
    const linkDelete = `{% url 'main:delete_product' '00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', item.id);

    const name = DOMPurify.sanitize(item.name || '');
    const description = DOMPurify.sanitize(item.description || '');
    const category = DOMPurify.sanitize(item.category || '');
    const thumbnail = DOMPurify.sanitize(item.thumbnail || '');
    const price = DOMPurify.sanitize(item.price || 0);
    const stock = DOMPurify.sanitize(item.stock || 0);
    const isFeatured = item.is_featured;
        const thumbnailHtml = DOMPurify.sanitize(
        item.thumbnail ? `<img src='${thumbnail}' alt='${name}' class='w-full h-full object-cover'>` : `<div class='w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center'></div>`
    );
    const categoryLabel = getReadableCategoryName(category);
    const featuredLabel = isFeatured ? `<span class='inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800'>Featured</span>` : '';

    const editDeleteHtml = CURRENT_USER_ID && Number(CURRENT_USER_ID) === Number(item.user_id)
        ? `<div class='flex space-x-2'>
            <button onclick='editProductAjax("${item.id}")' class='text-gray-600 hover:text-gray-700 text-sm transition-colors'>Edit</button>
            <button onclick='confirmDeleteProduct("${item.id}", "${name}")' class='text-red-600 hover:text-red-700 text-sm transition-colors'>Delete</button>
          </div>`
        : '';

    const cardHtml = `
          <div class="aspect-square relative overflow-hidden">
            <a href="${linkDetail}" class="block w-full h-full hover:opacity-90 transition-opacity">
              ${thumbnailHtml}
            </a>
          </div>
        <div class="p-4 flex flex-col flex-1">
          <div class="flex items-center gap-2 mb-3">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-md text-xs font-medium bg-blue-600 text-white">${categoryLabel}</span>
            ${featuredLabel}
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-3 line-clamp-2 leading-tight">
            <a href="${linkDetail}" class="hover:text-blue-600 transition-colors text-3xl">${name}</a>
          </h3>
          <div class="flex items-center mb-3 flex-grow">
            <span class="text-2xl font-bold text-green-600 py-1">Rp ${parseFloat(price || 0).toLocaleString('id-ID')}</span>
          </div>
          <div class="pt-4 border-t border-gray-200 flex items-center justify-between mt-auto">
            <a href="${linkDetail}" class="text-blue-600 hover:text-green-700 font-medium text-sm transition-colors">View</a>
            ${editDeleteHtml}
          </div>
        </div>
    `;
    
    article.innerHTML = cardHtml;
    return article;
} {% endcomment %}

{% endblock content %}