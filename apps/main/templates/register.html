{% extends 'base.html' %} {% load static %} {% block content %}

<div
  class="relative min-h-screen pt-30 flex items-center justify-center w-full "
>
  <div class="w-80 p-10 shadow-xl border-gray-200 rounded-2xl">
    <h1 class="pb-4 text-xl text-center font-bold">Register</h1>
    <form id="register-form" method="POST" action="{% url 'main:register' %}">
      {% csrf_token %}
      <div class="flex flex-col w-full gap-4">
        <div>
          <label
            for="username"
            class="block text-sm font-medium text-gray-700 mb-2"
          >
            Username
          </label>
          <input
            id="username"
            name="username"
            type="text"
            required
            class="w-full border px-2 py-1 border-gray-300 rounded-md focus:outline-none focus:border-red-200 transition-all"
            placeholder="Enter your username"
          />
        </div>

        <div>
          <label
            for="password1"
            class="block text-sm font-medium text-gray-700 mb-2"
          >
            Password
          </label>
          <input
            id="password1"
            name="password1"
            type="password"
            required
            class="w-full border px-2 py-1 border-gray-300 rounded-md focus:outline-none focus:border-red-200 transition-all"
            placeholder="Enter your password"
          />
        </div>

        <div>
          <label
            for="password2"
            class="block text-sm font-medium text-gray-700 mb-2"
          >
            Confirm Password
          </label>
          <input
            id="password2"
            name="password2"
            type="password"
            required
            class="w-full border px-2 py-1 border-gray-300 rounded-md focus:outline-none focus:border-red-200 transition-all"
            placeholder="Confirm your password"
          />
        </div>

        <button
          type="submit"
          class="w-full bg-gray-200 px-2 py-1 font-medium rounded-lg hover:brightness-90 transition-all"
        >
          Sign Up
        </button>

        <div class="text-center text-sm text-gray-600">
          Already have an account?
          <a href="{% url 'main:show_login' %}" class="text-blue-500 hover:underline">
            Login here
          </a>
        </div>
      </div>
    </form>
  </div>
</div>
<script>
  const form = document.getElementById("register-form");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = new FormData(form);

    try {
      const response = await fetch("/api/register/", {
        method: "POST",
        body: data,
      });

      const result = await response.json();

      if (!response.ok) {
        showToast(result.message, "", "error");
        return;
      }

      showToast(result.message, "", "success");
      setTimeout(() => {
        window.location.href = "/login/";
      }, 1500);
    } catch (error) {
      console.error("Error:", error);
      showToast("An error occurred. Please try again.", "", "error");
    }
  });
</script>
{% endblock content %}
