{% extends 'base.html' %} {% load static %} {% block meta %}
<title>gas.in | Login</title>
{% endblock meta %} {% block content %}

<div
  class="relative min-h-screen pt-30 flex items-center justify-center w-full"
>
  <div class="w-80 p-10 shadow-xl border-gray-100 border rounded-2xl">
    <h1 class="pb-4 text-xl text-center font-bold">Login</h1>
    <form id="login-form" method="POST" action="{% url 'main:login' %}">
      {% csrf_token %}
      <div class="flex flex-col w-full gap-4">
        <div>
          <label for="username" class="block text-sm font-medium mb-1">
            Username
          </label>
          <div class="w-full flex items-center gap-2 border-b">
            <img
              src="{% static 'image/user.png' %}"
              alt="icon"
              class="w-4 h-auto"
            />
            <input
              id="username"
              name="username"
              type="text"
              required
              class="w-full px-2 py-1 focus:outline-none focus:ring-none transition-all"
              placeholder="Type your username"
            />
          </div>
        </div>

        <div>
          <label for="password" class="block text-sm font-medium mb-1">
            Password
          </label>
          <div class="w-full flex items-center gap-2 border-b">
            <img
              src="{% static 'image/lock.png' %}"
              alt="icon"
              class="w-4 h-auto"
            />
            <input
              id="password"
              name="password"
              type="password"
              required
              class="w-full border-none px-2 py-1 focus:outline-none focus:ring-none transition-all"
              placeholder="Type your password"
            />
          </div>
        </div>

        <button
          type="submit"
          class="w-full bg-gradient-to-r from-indigo-700 to-purple-800 hover:shadow-md hover:-translate-y-0.5 transform duration-500 font-medium py-2 text-white rounded-full transition-all"
        >
          Sign In
        </button>
        <p class="text-gray-500 text-sm text-center">
          Don't have an account?
          <a
            href="{% url 'main:register' %}"
            class="text-purple-700 hover:text-purple-800 transition-all font-medium"
          >
            Register Now
          </a>
        </p>
      </div>
    </form>
  </div>
</div>
<script>
  const form = document.getElementById("login-form");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const data = new FormData(form);

    try {
      const response = await fetch("/api/login/", {
        method: "POST",
        body: data,
      });

      const result = await response.json();

      if (!response.ok) {
        showToast(result.message, "", "error");
        return; // ← TAMBAHKAN INI supaya stop di sini kalau error
      }

      showToast(result.message, "", "success");
      setTimeout(() => {
        window.location.href = result.redirect_url || "/"; // ← UBAH INI pakai redirect_url dari backend
      }, 1500);
    } catch (error) {
      console.error("Error:", error);
      showToast("An error occurred. Please try again.", "", "error");
    }
  });
</script>
{% endblock content %}
